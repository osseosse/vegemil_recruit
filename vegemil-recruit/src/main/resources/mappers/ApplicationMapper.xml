<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vegemil.mapper.ApplicationMapper">

	<sql id="informationColumns">
		idx, setup_th, join_num, DATE_FORMAT(join_date,'%Y-%m') as join_date, join_ok, join_type, join_company, join_field1, join_area1
		, sex, name_han, name_eng, photo, zip1, addr11, addr12, bohun, marry, religion
		, ability, hobby, handicap, fam_mem1, fam_mem2, fam_mem3, fam_con1, fam_name1, fam_age1
		, fam_con2, fam_name2, fam_age2, fam_con3, fam_name3, fam_age3, fam_con4, fam_name4, fam_age4
		, mil_class, mil_type, mil_lv, mil_arm, mil_ticket, DATE_FORMAT(mil_s_date,'%Y-%m') as mil_s_date, DATE_FORMAT(mil_e_date,'%Y-%m') as mil_e_date
	</sql>

	<insert id="savePersonalInformation" parameterType="com.vegemil.domain.ApplicationDTO" useGeneratedKeys="true" keyProperty="idx">
		INSERT INTO R_Recruit (
			setup_th, join_num, join_date, join_ok, join_type, join_company, join_field1, join_area1
			, sex, name_han, name_eng, photo, zip1, addr11, addr12, bohun, marry, religion
			, ability, hobby, handicap, fam_mem1, fam_mem2, fam_mem3, fam_con1, fam_name1, fam_age1
			, fam_con2, fam_name2, fam_age2, fam_con3, fam_name3, fam_age3, fam_con4, fam_name4, fam_age4
			, mil_class, mil_type, mil_lv, mil_arm, mil_ticket, mil_s_date, mil_e_date
		) VALUES (
			  #{setupTh}, #{joinNum}, NOW(), #{joinOk}, #{joinType}, #{joinField1}, #{joinArea1}
			, #{nameHan}, #{nameEng}, #{photo}, #{zip1}, #{addr11}, #{addr12}, #{marry}, #{religion}
			, #{ability}, #{like}, #{handicap}, #{famMem1}, #{famMem2}, #{famMem3}, #{famCon1}, #{famName1}, #{famAge1}
			, #{famCon2}, #{famName2}, #{famAge2}, #{famCon3}, #{famName3}, #{famAge3}, #{famCon4}, #{famName4}, #{famAge4}
			, #{milClass}, #{milType}, #{milLv}, #{milArm}, #{milTicket}, #{milSDate}, #{milEdate}
		)
	</insert>
	
	<update id="updatePersonalInformation" parameterType="com.vegemil.domain.ApplicationDTO">
		UPDATE R_Recruit
		SET
			  join_company= #{joinCompany}, join_type = #{joinType}, join_field1 = #{joinField1}, join_area1 = #{joinArea1}, name_han = #{nameHan}
			, sex = #{sex}, name_eng = #{nameEng}, photo = #{photo}, zip1 = #{zip1}, addr11 = #{addr11}, addr12 = #{addr12}
			, bohun = #{bohun}, marry = #{marry}, religion = #{religion}, ability = #{ability}, hobby = #{hobby}
			, handicap = #{handicap}, fam_mem1 = #{famMem1}, fam_mem2 = #{famMem2}, fam_mem3 = #{famMem3}
			, fam_con1 = #{famCon1}, fam_name1 = #{famName1}, fam_age1 = #{famAge1}, fam_con2 = #{famCon2}
			, fam_name2 = #{famName2}, fam_age2 = #{famAge2}, fam_con3 = #{famCon3}, fam_name3 = #{famName3}
			, fam_age3 = #{famAge3}, fam_con4 = #{famCon4}, fam_name4 = #{famName4}, fam_age4 = #{famAge4}
			, mil_class = #{milClass}, mil_type = #{milType}, mil_lv = #{milLv}, mil_arm = #{milArm} 
			, mil_ticket = #{milTicket}, mil_s_date = #{milSDate}, mil_e_date = #{milEdate}
		WHERE
			idx = #{idx} and mem_no= #{memNo}
	</update>

	<select id="selectApplicationByIdx" parameterType="map" resultType="com.vegemil.domain.ApplicationDTO">
		SELECT
			<include refid="informationColumns" />
		FROM
			R_Recruit
		WHERE
			idx = #{idx} and mem_no= #{memNo}
	</select>


	<select id="selectApplicationList" parameterType="com.vegemil.domain.ApplicationDTO" resultType="com.vegemil.domain.ApplicationDTO">
		SELECT
			<include refid="informationColumns" />
		FROM
			R_Recruit
		WHERE
		ORDER BY
			join_DATE ASC
		<include refid="CommonMapper.paging" />
	</select>

	<select id="selectApplicationCount" parameterType="long" resultType="int">
		SELECT
			COUNT(*)
		FROM
			R_Recruit
		WHERE
			mem_no= #{memNo}
		<include refid="CommonMapper.search" />
	</select>

</mapper>